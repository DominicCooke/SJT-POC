<head>
    <script src="fss.js" type="text/javascript"></script>
    <script src="snap.svg.js" type="text/javascript"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
    <div id="openModal" class="modalDialog">
        <div class="modalContent">
            <h2>Introduction/Instructions/Scenario</h2>
            <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.</p>
            <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.</p>
            <div class="close" onclick="hideModal()">Okay</div>
        </div>
    </div>
    <div class="svgContainer">
        <div class="videoContainer tl">
            <div class="overlay">
                <div class="media">
                    <div class="play fa fa-play-circle-o" onclick="clickPlay(this)"></div>
                    <video class="TLVideo hidden" controls onended="videoEnded(this)">
                        <source src="sample.mp4" type="video/mp4">
                    </video>
                    <div class="textbox hidden">
                        <h1>Option A</h1>
                        <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.</p>
                        <i class="fa fa-repeat" onclick="replayVideo(this)"></i>
                        <i class="fa fa-check" onclick="setcolorlight('tl')"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="videoContainer tr">
            <div class="overlay">
                <div class="media">
                    <div class="play fa fa-play-circle-o" onclick="clickPlay(this)"></div>
                    <video class="TRVideo hidden" controls onended="videoEnded(this)">
                        <source src="sample.mp4" type="video/mp4">
                    </video>
                    <div class="textbox hidden">
                        <h1>Option B</h1>
                        <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.</p>
                        <i class="fa fa-repeat" onclick="replayVideo(this)"></i>
                        <i class="fa fa-check" onclick="setcolorlight('tr')"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="videoContainer bl">
            <div class="overlay">
                <div class="media">
                    <div class="play fa fa-play-circle-o" onclick="clickPlay(this)"></div>
                    <video class="BLVideo hidden" controls onended="videoEnded(this)">
                        <source src="sample.mp4" type="video/mp4">
                    </video>
                    <div class="textbox hidden">
                        <h1>Option C</h1>
                        <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.</p>
                        <i class="fa fa-repeat" onclick="replayVideo(this)"></i>
                        <i class="fa fa-check" onclick="setcolorlight('bl')"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="videoContainer br">
            <div class="overlay">
                <div class="media">
                    <div class="play fa fa-play-circle-o" onclick="clickPlay(this)"></div>
                    <video class="BRVideo hidden" controls onended="videoEnded(this)">
                        <source src="sample.mp4" type="video/mp4">
                    </video>
                    <div class="textbox hidden">
                        <h1>Option D</h1>
                        <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.</p>
                        <i class="fa fa-repeat" onclick="replayVideo(this)"></i>
                        <i class="fa fa-check" onclick="setcolorlight('br')"></i>
                    </div>
                </div>
            </div>
        </div>
        <svg id="containerSvg" width="100%" height="100%">
            <svg id="TLMeshContainer"></svg>
            <svg id="TRMeshContainer"></svg>
            <svg id="BLMeshContainer"></svg>
            <svg id="BRMeshContainer"></svg>
            <svg id="borderContainer">
                <svg id="TLBorderContainer"></svg>
                <svg id="TRBorderContainer"></svg>
                <svg id="BLBorderContainer"></svg>
                <svg id="BRBorderContainer"></svg>
            </svg>
            <svg id="centralContainer"></svg>
        </svg>
    </div>

    <script>
        this.started = true;
        this.svgContainer = $('.svgContainer');

        init();
        window.addEventListener('resize', resize);

        function init() {
            this.widthOfContainer = svgContainer.width() / 2;
            this.heightOfContainer = svgContainer.height() / 2;
            draw();
        }

        function getContainers() {
            this.containerSvg = new Snap("#containerSvg");

            this.TLMeshContainer = containerSvg.select('#TLMeshContainer');
            this.TRMeshContainer = containerSvg.select('#TRMeshContainer');
            this.BLMeshContainer = containerSvg.select('#BLMeshContainer');
            this.BRMeshContainer = containerSvg.select('#BRMeshContainer');

            this.centralContainer = containerSvg.select('#centralContainer');

            this.borderContainer = containerSvg.select('#borderContainer');
            this.TLContainer = borderContainer.select('#TLBorderContainer');
            this.TRContainer = borderContainer.select('#TRBorderContainer');
            this.BLContainer = borderContainer.select('#BLBorderContainer');
            this.BRContainer = borderContainer.select('#BRBorderContainer');
        }

        function draw() {
            getContainers();
            drawBorders();
            drawCentral();
            drawPanes();
        }

        function resize() {
            this.widthOfContainer = svgContainer.width() / 2;
            this.heightOfContainer = svgContainer.height() / 2;
            refreshContainers();
        }

        function drawPanes() {
            TLMeshContainer.attr({
                width: widthOfContainer + "px"
            });
            TRMeshContainer.attr({
                x: widthOfContainer,
                width: widthOfContainer + "px"
            });
            BLMeshContainer.attr({
                y: heightOfContainer,
                width: widthOfContainer + "px"
            });
            BRMeshContainer.attr({
                y: heightOfContainer,
                x: widthOfContainer,
                width: widthOfContainer + "px"
            });

            TLMeshContainer.rect(0, 0, widthOfContainer, heightOfContainer).attr({
                fill: "#000"
            });
            TRMeshContainer.rect(0, 0, widthOfContainer, heightOfContainer).attr({
                fill: "#000"
            });
            BLMeshContainer.rect(0, 0, widthOfContainer, heightOfContainer).attr({
                fill: "#000"
            });
            BRMeshContainer.rect(0, 0, widthOfContainer, heightOfContainer).attr({
                fill: "#000"
            });

            TLMesh = new Mesh(containerSvg, TLMeshContainer, "#120222", "#39b033", "tl");
            TLMesh.start();

            TRMesh = new Mesh(containerSvg, TRMeshContainer, "#120222", "#337ab0", "tr");
            TRMesh.start();

            BLMesh = new Mesh(containerSvg, BLMeshContainer, "#120222", "#622970", "bl");
            BLMesh.start();

            BRMesh = new Mesh(containerSvg, BRMeshContainer, "#120222", "#fc2436", "br");
            BRMesh.start();
        }

        function drawBorders() {

            borderContainer.attr({
                y: 0,
                x: 0,
                width: svgContainer.width() + "px",
                height: svgContainer.height() + "px"
            });

            var verticalWidth = widthOfContainer / 20;
            var horizontalHeight = widthOfContainer / 20;

            // top left right
            var TLRightMask = TLContainer.rect(0, 0, verticalWidth, heightOfContainer).attr({
                fill: "white"
            });
            TLRightMesh = new Mesh(containerSvg, TLContainer, "#120222", "#39b033", "borderVertical");
            TLRightMesh.el.attr({
                mask: TLRightMask,
                transform: 'translate(' + (widthOfContainer - verticalWidth) + ',-20)'
            });
            TLRightMesh.start();

            // top left bottom
            var TLBottomMask = TLContainer.rect(0, 0, widthOfContainer, horizontalHeight).attr({
                fill: "white"
            });
            TLBottomMesh = new Mesh(containerSvg, TLContainer, "#120222", "#39b033", "borderHorizontal");
            TLBottomMesh.el.attr({
                mask: TLBottomMask,
                transform: 'translate(-20,' + (heightOfContainer - horizontalHeight) + ')'
            });
            TLBottomMesh.start();


            // top right left
            var TRLeftMask = TRContainer.rect(0, 0, verticalWidth, heightOfContainer).attr({
                fill: "white"
            });
            TRLeftMesh = new Mesh(containerSvg, TRContainer, "#120222", "#337ab0", "borderVertical");
            TRLeftMesh.el.attr({
                mask: TRLeftMask,
                transform: 'translate(' + widthOfContainer + ',-20) rotate(180 ' + verticalWidth / 2 + '  ' + heightOfContainer / 2 + ')'
            });
            TRLeftMesh.start();

            // top right bottom
            var TRBottomMask = TRContainer.rect(0, 0, widthOfContainer, horizontalHeight).attr({
                fill: "white"
            });
            TRBottomMesh = new Mesh(containerSvg, TRContainer, "#120222", "#337ab0", "borderHorizontal");
            TRBottomMesh.el.attr({
                mask: TRBottomMask,
                transform: 'translate(' + widthOfContainer + ',' + (heightOfContainer - horizontalHeight) + ')'
            });
            TRBottomMesh.start();

            // bottom left top
            var BLTopMask = BLContainer.rect(0, 0, widthOfContainer, horizontalHeight).attr({
                fill: "white"
            });
            BLTopMesh = new Mesh(containerSvg, BLContainer, "#120222", "#622970", "borderHorizontal");
            BLTopMesh.el.attr({
                mask: BLTopMask,
                transform: 'translate(-20,' + heightOfContainer + ') rotate(180 ' + widthOfContainer / 2 + '  ' + horizontalHeight / 2 + ')'
            });
            BLTopMesh.start();

            // bottom left right
            var BLRightMask = BLContainer.rect(0, 0, verticalWidth, heightOfContainer).attr({
                fill: "white"
            });
            BLRightMesh = new Mesh(containerSvg, BLContainer, "#120222", "#622970", "borderVertical");
            BLRightMesh.el.attr({
                mask: BLRightMask,
                transform: 'translate(' + (widthOfContainer - verticalWidth) + ',' + heightOfContainer + ')'
            });
            BLRightMesh.start();

            // bottom right top
            var BRTopMask = BRContainer.rect(0, 0, widthOfContainer, horizontalHeight).attr({
                fill: "white"
            });
            BRTopMesh = new Mesh(containerSvg, BRContainer, "#120222", "#fc2436", "borderHorizontal");
            BRTopMesh.el.attr({
                mask: BRTopMask,
                transform: 'translate(' + (widthOfContainer + 20) + ',' + heightOfContainer + ') rotate(180 ' + widthOfContainer / 2 + '  ' + horizontalHeight / 2 + ')'
            });
            BRTopMesh.start();

            // bottom right left
            var BRLeftMask = BRContainer.rect(0, 0, verticalWidth, heightOfContainer).attr({
                fill: "white"
            });
            BRLeftMesh = new Mesh(containerSvg, BRContainer, "#120222", "#fc2436", "borderVertical");
            BRLeftMesh.el.attr({
                mask: BRLeftMask,
                transform: 'translate(' + widthOfContainer + ',' + (heightOfContainer+20) + ') rotate(180 ' + verticalWidth / 2 + '  ' + heightOfContainer / 2 + ')'
            });
            BRLeftMesh.start();

        }

        function drawCentral() {
            var diameter = svgContainer.width() / 10;
            var radius = diameter / 2;
            var pos = radius + 20;
            centralContainer.attr({
                width: diameter + "px",
                height: diameter + "px",
                x: widthOfContainer - radius,
                y: heightOfContainer - radius
            });

            var centralCircleMask = centralContainer.circle(pos, pos, radius).attr({
                stroke: "black",
                fill: "white"
            });

            centralMesh = new Mesh(containerSvg, centralContainer, "#afafaf", "#afafaf", "ct");
            centralMesh.el.attr({
                mask: centralCircleMask
            });
            centralMesh.start();
        }

        function refreshContainers() {
            TLMesh.stop();
            TRMesh.stop();
            BLMesh.stop();
            BRMesh.stop();
            centralMesh.stop();
            TLBottomMesh.stop();
            TLRightMesh.stop();
            TRLeftMesh.stop();
            TRBottomMesh.stop();
            BLTopMesh.stop();
            BLRightMesh.stop();
            BRTopMesh.stop();
            BRLeftMesh.stop();

            $("#TLMeshContainer").empty();
            $("#TRMeshContainer").empty();
            $("#BLMeshContainer").empty();
            $("#BRMeshContainer").empty();

            $("#TLBorderContainer").empty();
            $("#TRBorderContainer").empty();
            $("#BLBorderContainer").empty();
            $("#BRBorderContainer").empty();

            $("#centralContainer").empty();
            draw();
        }

        function setcolorlight(orientation) {
            if (orientation == 'tl') {
                TLMesh.rippleColor("#39b033", "#e9fcf6", "tl", "light");
                centralMesh.rippleColor("#39b033", "#e9fcf6", "ct");
                revertToDark(orientation);
            } else if (orientation == 'tr') {
                TRMesh.rippleColor("#337ab0", "#e9fcf6", "tr", "light");
                centralMesh.rippleColor("#337ab0", "#e9fcf6", "ct");
                revertToDark(orientation);
            } else if (orientation == 'bl') {
                BLMesh.rippleColor("#622970", "#e9fcf6", "bl", "light");
                centralMesh.rippleColor("#622970", "#e9fcf6", "ct");
                revertToDark(orientation);
            } else if (orientation == 'br') {
                BRMesh.rippleColor("#fc2436", "#e9fcf6", "br", "light");
                centralMesh.rippleColor("#fc2436", "#e9fcf6", "ct");
                revertToDark(orientation);
            }

            function revertToDark(current) {
                if (TLMesh.getColorA() != "#120222" && current != "tl") {
                    TLMesh.rippleColor("#120222", "#39b033", "tl", "dark");
                } else if (TRMesh.getColorA() != "#120222" && current != "tr") {
                    TRMesh.rippleColor("#120222", "#337ab0", "tr", "dark");
                } else if (BLMesh.getColorA() != "#120222" && current != "bl") {
                    BLMesh.rippleColor("#120222", "#622970", "bl", "dark");
                } else if (BRMesh.getColorA() != "#120222" && current != "br") {
                    BRMesh.rippleColor("#120222", "#fc2436", "br", "dark");
                }
            }

        }

        function randomHex() {
            return '#' + Math.floor(Math.random() * 16777215).toString(16);
        }

        function hideModal() {
            $(".modalDialog").addClass("hidden");
        }

        function videoEnded(videoElement) {
            var textBoxElement = $(videoElement.nextElementSibling);
            $(videoElement).fadeOut(500, function() {
                textBoxElement.removeClass("hidden");
                $(videoElement).addClass("hidden");
                $(videoElement).css('display', '');
                textBoxElement.animate({
                    opacity: 1
                }, 1500);
            });
        }

        function replayVideo(replayElement) {
            var videoElement = $(replayElement).parent().parent().find('video');
            var textBoxElement = $(replayElement).parent();
            textBoxElement.animate({
                opacity: 0
            }, 1500, function() {
                textBoxElement.addClass("hidden");
                videoElement.removeClass("hidden");
                videoElement[0].currentTime = 0;
                videoElement.animate({
                    opacity: 1
                }, 2500, function() {
                    setTimeout(function() {
                        videoElement[0].play();
                    }, 500);
                });
            });
        }

        function clickPlay(playElement) {
            var videoElement = $(playElement.nextElementSibling);
            $(playElement).fadeOut(500, function() {
                $(playElement).removeClass("clickable");
                videoElement.css('width', 'auto').addClass("clickable").removeClass("hidden").animate({
                    opacity: 1
                }, 2500, function() {
                    setTimeout(function() {
                        videoElement[0].play();
                    }, 500);
                });

            });
        }

        function Mesh(s, container, colorA, colorB, orientation) {
            var instance = this,
                _width = widthOfContainer + 50,
                _height = heightOfContainer + 50,
                instanceColorA = colorA,
                instanceColorB = colorB,
                now,
                start = Date.now(),
                renderer,
                scene,
                geometry,
                material,
                mesh,
                light;

            if (orientation == "ct") {
                _width = container.node.getBBox().width + 50;
                _height = container.node.getBBox().height + 50;
            } else if (orientation == "borderHorizontal") {
                _width = container.node.getBBox().width * (4 / 3);
                _height = 50;
            } else if (orientation == "borderVertical") {
                _width = 50;
                _height = container.node.getBBox().height * (4 / 3);
            }

            instance.animating = false;

            instance.init = function() {
                renderer = new FSS.SVGRenderer(s);
                renderer.setSize(_width, _height);
                instance.el = renderer.element;
                container.append(renderer.element);

                scene = new FSS.Scene();
                material = new FSS.Material(colorA, colorB);
                light = new FSS.Light('#eeeeee', '#eeeeee');

                if (orientation != "ct" && orientation != "borderHorizontal" && orientation != "borderVertical") {
                    geometry = new FSS.Plane(_width, _height, 8, 8, s, material);
                    renderer.element.transform('translate(-20, -20)'); //keep edges from showing
                } else if (orientation == "ct") {
                    geometry = new FSS.Plane(_width, _height, 10, 10, s, material);
                    renderer.element.transform('translate(-20, -20)'); //keep edges from showing
                } else if (orientation == "borderHorizontal") {
                    geometry = new FSS.Plane(_width, _height, 10, 2, s, material);
                } else if (orientation == "borderVertical") {
                    geometry = new FSS.Plane(_width, _height, 2, 10, s, material);
                }

                mesh = new FSS.Mesh(geometry, material);
                scene.add(mesh);

                if (orientation == "tl") {
                    light.setPosition(widthOfContainer / 2, -heightOfContainer / 2, 100);
                } else if (orientation == "tr") {
                    light.setPosition(-widthOfContainer / 2, -heightOfContainer / 2, 100);
                } else if (orientation == "bl") {
                    light.setPosition(widthOfContainer / 2, heightOfContainer / 2, 100);
                } else if (orientation == "br") {
                    light.setPosition(-widthOfContainer / 2, heightOfContainer / 2, 100);
                } else if (orientation == "ct") {
                    light.setPosition(0, 0, 5);
                } else {
                    light.setPosition(0, 0, 100);
                }

                scene.add(light);
                now = Date.now() - start;

                tweakMesh();
                distortMesh();
                renderer.render(scene);
            }

            instance.start = function() {
                instance.animating = true;
                animate();
            }

            instance.stop = function() {
                instance.animating = false;
            }

            instance.setColor = function(colorA, colorB) {
                var i;
                material = new FSS.Material(colorA, colorB);

                for (i = geometry.triangles.length - 1; i > -1; i -= 1) {
                    geometry.triangles[i].material = material;
                }
            }

            instance.getColorA = function() {
                return instanceColorA;
            }

            instance.getColorB = function() {
                return instanceColorB;
            }

            instance.rippleColor = function(colorA, colorB, orientation, type) {
                var i, speed, list1, list2, list3, list4, list5, list6, list7, collateListTL, collateListTR, collateListBL, collateListBR;
                instanceColorA = colorA;
                instanceColorB = colorB;

                list1 = [127, 111, 126, 110, 125, 109];
                list2 = [95, 94, 124, 93, 108, 123, 92, 107, 91];
                list3 = [79, 78, 77, 76, 122, 121, 106, 105, 90, 75, 74, 89, 73];
                list4 = [63, 62, 61, 60, 120, 104, 119, 59, 58, 88, 103, 118, 57, 72, 87, 102, 56, 55, 54, 70, 71, 86];
                list5 = [47, 46, 45, 44, 43, 42, 41, 40, 39, 38, 37, 36, 52, 53, 68, 69, 84, 85, 100, 101, 116, 117];
                list6 = [31, 30, 29, 28, 27, 26, 25, 24, 23, 22, 21, 20, 19, 18, 34, 35, 50, 51, 66, 67, 82, 83, 98, 99, 114, 115];
                list7 = [15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 16, 17, 32, 33, 48, 49, 64, 65, 80, 81, 96, 97, 112, 113];
                collateListTL = [list1, list2, list3, list4, list5, list6, list7];
                list1 = [15, 14, 31, 30, 13, 29];
                list2 = [11, 12, 27, 28, 43, 44, 45, 46, 47];
                list3 = [9, 10, 25, 26, 41, 42, 57, 58, 59, 60, 61, 62, 63];
                list4 = [6, 7, 8, 22, 23, 24, 38, 39, 40, 54, 55, 56, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79];
                list5 = [4, 5, 20, 21, 36, 37, 52, 53, 68, 69, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95];
                list6 = [2, 3, 18, 19, 34, 35, 50, 51, 66, 67, 82, 83, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111];
                list7 = [0, 1, 16, 17, 32, 33, 48, 49, 64, 65, 80, 81, 96, 97, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127];
                collateListTR = [list1, list2, list3, list4, list5, list6, list7];
                list1 = [0, 1, 2, 16, 17, 18];
                list2 = [3, 4, 19, 20, 32, 33, 34, 35, 36];
                list3 = [5, 6, 21, 22, 37, 38, 48, 49, 50, 51, 52, 53, 54];
                list4 = [7, 8, 9, 23, 24, 25, 39, 40, 41, 55, 56, 57, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73];
                list5 = [10, 11, 26, 27, 42, 43, 58, 59, 74, 75, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91];
                list6 = [12, 13, 28, 29, 44, 45, 60, 61, 76, 77, 92, 93, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109];
                list7 = [14, 15, 30, 31, 46, 47, 62, 63, 78, 79, 94, 95, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127];
                collateListBR = [list1, list2, list3, list4, list5, list6, list7];
                list1 = [96, 97, 98, 112, 113, 114];
                list2 = [80, 81, 82, 83, 84, 99, 100, 115, 116];
                list3 = [64, 65, 66, 67, 68, 69, 70, 85, 86, 101, 102, 117, 118];
                list4 = [48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 71, 72, 73, 87, 88, 89, 103, 104, 105, 119, 120, 121];
                list5 = [32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 58, 59, 74, 75, 90, 91, 106, 107, 122, 123];
                list6 = [16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 44, 45, 60, 61, 76, 77, 92, 93, 108, 109, 124, 125];
                list7 = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 30, 31, 46, 47, 62, 63, 78, 79, 94, 95, 110, 111, 126, 127];
                collateListBL = [list1, list2, list3, list4, list5, list6, list7];

                material = new FSS.Material(colorA, colorB);

                if (orientation == "tl") {
                    if (type == "light") {
                        ripple(collateListTL);
                    } else {
                        reverseRipple(collateListTL);
                    }
                } else if (orientation == "tr") {
                    if (type == "light") {
                        ripple(collateListTR);
                    } else {
                        reverseRipple(collateListTR);
                    }
                } else if (orientation == "bl") {
                    if (type == "light") {
                        ripple(collateListBL);
                    } else {
                        reverseRipple(collateListBL);
                    }
                } else if (orientation == "br") {
                    if (type == "light") {
                        ripple(collateListBR);
                    } else {
                        reverseRipple(collateListBR);
                    }
                } else if (orientation == "ct") {
                    for (i = geometry.triangles.length - 1; i > -1; i -= 1) {
                        speed = Math.floor((Math.random() * (900 + 400)) + 400);
                        setTimeout(colorTriangle, speed, i);
                    }
                }

                function colorTriangle(j) {
                    geometry.triangles[j].material = material;
                }

                function ripple(list) {
                    for (i = 0; i < list.length; i++) {
                        for (j = 0; j < list[i].length; j++) {
                            var num = list[i][j];
                            if (i == 0) {
                                speed = Math.floor((Math.random() * (550 + 1)) + 1);
                            }
                            if (i == 1) {
                                speed = Math.floor((Math.random() * (1000 - 450 + 1)) + 450);
                            }
                            if (i == 2) {
                                speed = Math.floor((Math.random() * (1200 - 800 + 1)) + 800);
                            }
                            if (i == 3) {
                                speed = Math.floor((Math.random() * (1600 - 1000 + 1)) + 1000);
                            }
                            if (i == 4) {
                                speed = Math.floor((Math.random() * (2100 - 1400 + 1)) + 1400);
                            }
                            if (i == 5) {
                                speed = Math.floor((Math.random() * (2500 - 1700 + 1)) + 1700);
                            }
                            if (i == 6) {
                                speed = Math.floor((Math.random() * (2600 - 1900 + 1)) + 1900);
                            }
                            setTimeout(colorTriangle, speed, num);
                        }
                    }
                }

                function reverseRipple(list) {
                    for (i = list.length - 1; i > -1; i--) {
                        for (j = 0; j < list[i].length; j++) {
                            var num = list[i][j];
                            if (i == 6) {
                                speed = Math.floor((Math.random() * (550 + 1)) + 1);
                            }
                            if (i == 5) {
                                speed = Math.floor((Math.random() * (1000 - 450 + 1)) + 450);
                            }
                            if (i == 4) {
                                speed = Math.floor((Math.random() * (1200 - 800 + 1)) + 800);
                            }
                            if (i == 3) {
                                speed = Math.floor((Math.random() * (1600 - 1000 + 1)) + 1000);
                            }
                            if (i == 2) {
                                speed = Math.floor((Math.random() * (2100 - 1400 + 1)) + 1400);
                            }
                            if (i == 1) {
                                speed = Math.floor((Math.random() * (2500 - 1700 + 1)) + 1700);
                            }
                            if (i == 0) {
                                speed = Math.floor((Math.random() * (2600 - 1900 + 1)) + 1900);
                            }
                            setTimeout(colorTriangle, speed, num);
                        }
                    }
                }
            }

            function tweakMesh() {
                var v, vertex;

                for (v = geometry.vertices.length - 1; v >= 0; v--) {
                    vertex = geometry.vertices[v];
                    vertex.anchor = FSS.Vector3.clone(vertex.position);
                    vertex.step = FSS.Vector3.create(
                        Math.randomInRange(0.2, 1.0),
                        Math.randomInRange(0.2, 1.0),
                        Math.randomInRange(0.2, 1.0)
                    );
                    vertex.time = Math.randomInRange(0, Math.PIM2);
                }
            }

            function distortMesh() {
                var v,
                    vertex,
                    ox, oy, oz,
                    offset = 10 / 2;

                for (v = geometry.vertices.length - 1; v >= 0; v--) {
                    vertex = geometry.vertices[v];
                    ox = Math.sin(vertex.time + vertex.step[0] * now * 0.002);
                    oy = Math.cos(vertex.time + vertex.step[1] * now * 0.002);
                    oz = Math.sin(vertex.time + vertex.step[2] * now * 0.002);
                    FSS.Vector3.set(vertex.position,
                        0.2 * geometry.segmentWidth * ox,
                        0.1 * geometry.sliceHeight * oy,
                        1.1 * offset * oz - offset);
                    FSS.Vector3.add(vertex.position, vertex.anchor);
                }

                geometry.dirty = true;
            }

            function animate() {
                now = Date.now() - start;
                distortMesh();
                renderer.render(scene);
                if (instance.animating !== false) {
                    requestAnimationFrame(animate);
                }
            }

            instance.init();
        }

    </script>
</body>
